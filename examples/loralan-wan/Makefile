# If no BOARD is found in the environment, use this default:
BOARD ?= unwd-range-l1-r3

# LORA_REGION ?= EU868
LORA_REGION ?= RU864
CFLAGS += -DREGION_$(LORA_REGION)

############ UMDK MODULES USED #####################
# variable in the list below must match modules'
# subdirectory name in ../../unwired-modules/
# and no other variable should have umdk-% name

umdk-gpio	   = 1
umdk-4btn	   = 1
umdk-gps	   = 1
umdk-lm75	   = 1
umdk-lsm6ds3   = 1
umdk-lmt01	   = 1
umdk-uart	   = 1
umdk-sht21	   = 1
umdk-pir	   = 1
umdk-adc	   = 1
umdk-lps331    = 1
umdk-counter   = 1
umdk-rssiecho  = 1
umdk-pwm	   = 1
umdk-opt3001   = 1
umdk-bme280    = 1
umdk-config    = 1
umdk-mhz19     = 1
umdk-usound    = 1
umdk-hd44780   = 1
umdk-ibutton   = 1
umdk-irblaster = 1
umdk-hx711     = 1
umdk-fdc1004   = 1
umdk-adxl345   = 1
umdk-modbus	   = 1

####### UMDK MODULES defines and Makefile.include inclusion ############

define umdk_add_module
ifeq ($($(UMDK_MODULE_NAME)),1)
    USEMODULE += $(UMDK_MODULE_NAME)
endif
endef

$(foreach UMDK_MODULE_NAME, $(filter umdk-%, ${.VARIABLES}), $(eval $(call umdk_add_module, $UMDK_MODULE_NAME)))

UMDK_MODULES_MAKEFILES = $(addsuffix /Makefile.include, $(addprefix ../../unwired-modules/, $(filter umdk-%, ${USEMODULE})))

define umdk_include_makefile
ifneq ("$(wildcard $(FILE))","")
	include $(FILE)
endif
endef

$(foreach FILE, $(UMDK_MODULES_MAKEFILES), $(eval $(call umdk_include_makefile, $FILE)))

################ Other modules to include ################
USEMODULE += shell
USEMODULE += shell_commands
USEMODULE += ps
USEMODULE += od
USEMODULE += xtimer
USEMODULE += cipher_modes
USEMODULE += random
USEMODULE += hashes
USEMODULE += checksum
USEMODULE += rtctimers-millis

USEPKG += semtech-loramac
USEMODULE += sx127x

EXTERNAL_MODULE_DIRS += $(RIOTBASE)/unwired-modules/
USEMODULE += loralan-common
USEMODULE += unwds-common

INCLUDES += -I$(RIOTBASE)/unwired-modules/loralan-mac/include/
INCLUDES += -I$(RIOTBASE)/unwired-modules/loralan-common/include/
INCLUDES += -I$(RIOTBASE)/unwired-modules/unwds-common/include/

####################################################

# name of your application
APPLICATION = lorawan-public

# This has to be the absolute path to the RIOT base directory:
RIOTBASE ?= $(CURDIR)/../..

FEATURES_REQUIRED += periph_adc
FEATURES_REQUIRED += periph_dac
FEATURES_REQUIRED += periph_gpio
FEATURES_REQUIRED += periph_i2c
FEATURES_REQUIRED += periph_pwm
FEATURES_REQUIRED += periph_rtc
FEATURES_REQUIRED += periph_spi
FEATURES_REQUIRED += periph_eeprom
FEATURES_REQUIRED += periph_uart
FEATURES_REQUIRED += periph_pm
FEATURES_REQUIRED += periph_iwdg
FEATURES_REQUIRED += periph_cpuid

QUIET ?= 1

#CFLAGS += -DDEVELHELP
CFLAGS += -DNO_RIOT_BANNER

####################################################

CFLAGS += -DAES_NO_DECRYPTION
CFLAGS += -DCRYPTO_AES

FEATURES_OPTIONAL += config
FEATURES_OPTIONAL += periph_rtc

include $(RIOTBASE)/Makefile.include
